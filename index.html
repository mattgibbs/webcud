<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>LCLS Status</title>
		<meta name="author" content="Matt Gibbs">
		<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="metricsgraphics.css" rel="stylesheet">
		<link href="cud.css" rel="stylesheet">
		<script src="d3/d3.v3.min.js"></script>
		<script src="metricsgraphics.min.js"></script>
	</head>
	<body>
		<div class="container-fluid">
			<div class="row">
				<div class="col-xs-12 col-sm-6">
					<div class="cell-label">
						<h1>LCLS Linac Status <span id="errormsg"></span></h1>
					</div>
					<div class="row">
						<div class="col-xs-12 col-sm-6 col-md-3">
							<div class="cell-label">
								Machine Rate
							</div>
							<span id="machineRate" class="cell PVmonitor" data-pv="SIOC:SYS0:ML00:AO467"></span>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-3">
							<div class="cell-label">
								Bunch Charge
							</div>
							<span id="bunchCharge" class="cell PVmonitor" data-pv="SIOC:SYS0:ML00:CALC997"></span>
						</div>
						<div class="col-xs-12 col-sm-12 col-md-6">
							<div class="cell-label">
								L3 Energy
							</div>
							<span id="L3Energy" class="cell PVmonitor" data-pv="SIOC:SYS0:ML00:AO500" data-precision="3"></span><span id="L3Vernier" data-pv="FBCK:FB04:LG01:DL2VERNIER" data-units="" data-precision="1"></span>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-12">
							<table class="table" id="emittanceTable">
								<thead>
									<tr>
										<th></th>
										<th>X Emittance / Bmag</th>
										<th>Y Emittance / Bmag</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<th scope="row">WS02</th>
										<td><span id="WS02XEmit" class="emittanceValue" data-pv="WIRE:IN20:561:EMITN_X" data-precision="2" data-units=""></span> / <span id="WS02XMatch" class="matchingValue" data-pv="WIRE:IN20:561:BMAG_X" data-precision="2" data-units=""></span></td>
										<td><span id="WS02YEmit" class="emittanceValue" data-pv="WIRE:IN20:561:EMITN_Y" data-precision="2" data-units=""></span> / <span id="WS02YMatch" class="matchingValue" data-pv="WIRE:IN20:561:BMAG_Y" data-precision="2" data-units=""></span></td>
									</tr>
									<tr>
										<th scope="row">WS12</th>
										<td><span id="WS12XEmit" class="emittanceValue" data-pv="WIRE:LI21:293:EMITN_X" data-precision="2" data-units=""></span> / <span id="WS12XMatch" class="matchingValue" data-pv="WIRE:LI21:293:BMAG_X" data-precision="2" data-units=""></span></td>
										<td><span id="WS12YEmit" class="emittanceValue" data-pv="WIRE:LI21:293:EMITN_Y" data-precision="2" data-units=""></span> / <span id="WS12YMatch" class="matchingValue" data-pv="WIRE:LI21:293:BMAG_Y" data-precision="2" data-units=""></span></td>
									</tr>
									<tr>
										<th scope="row">LI28</th>
										<td><span id="LI28XEmit" class="emittanceValue" data-pv="WIRE:LI28:144:EMITN_X" data-precision="2" data-units=""></span> / <span id="LI28XMatch" class="matchingValue" data-pv="WIRE:LI28:144:BMAG_X" data-precision="2" data-units=""></span></td>
										<td><span id="LI28YEmit" class="emittanceValue" data-pv="WIRE:LI28:144:EMITN_Y" data-precision="2" data-units=""></span> / <span id="LI28YMatch" class="matchingValue" data-pv="WIRE:LI28:144:BMAG_Y" data-precision="2" data-units=""></span></td>
									</tr>
									<tr>
										<th scope="row">LTU</th>
										<td><span id="LTUXEmit" class="emittanceValue" data-pv="WIRE:LTU1:735:EMITN_X" data-precision="2" data-units=""></span> / <span id="LTUXMatch" class="matchingValue" data-pv="WIRE:LTU1:735:BMAG_X" data-precision="2" data-units=""></span></td>
										<td><span id="LTUYEmit" class="emittanceValue" data-pv="WIRE:LTU1:735:EMITN_Y" data-precision="2" data-units=""></span> / <span id="LTUYMatch" class="matchingValue" data-pv="WIRE:LTU1:735:BMAG_Y" data-precision="2" data-units=""></span></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-12 col-sm-6 col-md-4">
							<div class="cell-label">
								BC1 Peak Current
							</div>
							<span id="BC1PeakCurrent" class="cell PVmonitor" data-pv="BLEN:LI21:265:AIMAX1H"></span>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4">
							<div class="cell-label">
								L1S Phase
							</div>
							<span id="L1SPhase" class="cell PVmonitor" data-pv="ACCL:LI21:1:L1S_PDES" data-units="&deg" data-precision="1"></span>
						</div>
						<div class="col-xs-12 col-sm-12 col-md-4">
							<div class="cell-label">
								BC1 Energy
							</div>
							<span id="BC1Energy" class="cell PVmonitor" data-pv="SIOC:SYS0:ML00:AO483"></span>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-12 col-sm-6 col-md-4">
							<div class="cell-label">
								BC2 Peak Current
							</div>
							<span id="BC2PeakCurrent" class="cell PVmonitor" data-pv="BLEN:LI24:886:BIMAX1H"></span>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4">
							<div class="cell-label">
								L2 Phase
							</div>
							<span id="L2Phase"  class="cell PVmonitor" data-pv="ACCL:LI22:1:PDES" data-units="&deg" data-precision="1"></span>
						</div>
						<div class="col-xs-12 col-sm-12 col-md-4">
							<div class="cell-label">
								BC2 Energy
							</div>
							<span id="BC2Energy" class="cell PVmonitor" data-pv="SIOC:SYS0:ML00:AO489" data-precision="1"></span>
						</div>
					</div>
				</div>
				<div class="col-xs-12 col-sm-6"><!-- FEL Status -->
					<div class="cell-label">
						<h1>FEL Status</h1>
					</div>
					<div class="row">
						<div class="col-xs-12 col-sm-12 col-md-4">
							<div class="cell-label">
								FEL Pulse Energy
							</div>
							<span id="GDETEnergy" class="cell PVmonitor" data-pv="SIOC:SYS0:ML00:CALC000" data-precision="1"></span>
						</div>
						<div class="col-xs-12 col-sm-12 col-md-4">
							<div class="cell-label">
								Photon Energy
							</div>
							<span id="photonEnergy" class="cell PVmonitor" data-pv="SIOC:SYS0:ML00:AO627" data-precision="1"></span>
						</div>
						<div class="col-xs-12 col-sm-12 col-md-4">
							<div class="cell-label">
								Amplification Mode
							</div>
							<span id="amplificationMode" class="cell"  data-pv="SIOC:SYS0:ML00:CALC998" data-units=""></span>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-12 col-sm-12 col-md-4">
							<div class="cell-label">
								Pulse Length
							</div>
							<span id="pulseLength" class="cell PVmonitor" data-pv="SIOC:SYS0:ML00:AO820"></span>
						</div>
						<div class="col-xs-12 col-sm-12 col-md-4">
							<div class="cell-label">
								Energy Loss
							</div>
							<span id="eLoss" class="cell PVmonitor" data-pv="PHYS:SYS0:1:ELOSSRESULT"></span>
						</div>
					</div>
					<!--
					<div class="cell-label" style="padding-top: 30px">
						<h1>Scheduled Program</h1>
					</div>
					<div class="row">
						<div class="span9">
							<h3>Deliver to MEC for photon MD and instrument checkout.</h3>
						</div>
					</div>
					<div class="row">
						<div class="span9">
							<h2 id="abortMessage" style="visibility: hidden;">BYKICK aborting every <span class="cell PVmonitor" id="abortRate" data-pv="IOC:IN20:EV01:BYKIK_ABTPRD" data-units=""></span> pulses.</h2>
							<h2 id="burstMessage" style="visibility: hidden;">Burst Mode is enabled, users requesting <span class="cell PVmonitor" id="burstRate" data-pv="EVNT:SYS0:1:LCLSBURSRATE"></span>.</h2>
						</div>
					</div>
          -->
				</div>
			</div>
			<div class="row"><!-- graph row begin -->
				<div class="col-xs-12" id="history">
					<div class="cell-label">
						<h1>24 Hour Gas Detector History</h1>
					</div>
					<div id="gdethistory"></div>
					<script>
						var gdet_plot_params = {
			          width: 800,
			          full_width: true,
                y_extended_ticks: true,
                xax_start_at_min: true,
			          height: 160,
			          target: '#gdethistory',
			          x_accessor: 'date',
			          y_accessor: 'val',
			          min_y: 0,
			          area: true,
							y_label: "mJ" };
							
						function getGDETData() {
              var now = new Date();
              var oneDayAgo = new Date(now - 60*60*24*1000);
							d3.json('http://lcls-archapp.slac.stanford.edu/retrieval/data/getData.json?pv=mean_360(SIOC:SYS0:ML00:CALC000)'+'&from='+oneDayAgo.toISOString()+'&to='+now.toISOString(), function(data) {
				        var time_series = data[0].data.map(function(item) {
				          return {"date": new Date(item.secs * 1000), "val": item.val};
				        });
								gdet_plot_params.data = time_series;
								gdet_plot_params.min_x = time_series[0].date;
				        MG.data_graphic(gdet_plot_params);
				      });
						};
						getGDETData();
						setInterval(function() { getGDETData(); }, 120000);
					</script>
				</div>
			</div><!-- graph row end -->	
		</div><!-- container end -->
	</body>
	<script src="socket/webPV-Socket.js"></script>
	<script src="socket/webcud-socket.js"></script>
</html>