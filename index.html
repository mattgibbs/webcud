<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>LCLS Status</title>
		<meta name="author" content="Matt Gibbs">
		<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="cud.css" rel="stylesheet">
		<script src="d3/d3.v2.min.js"></script>
		<script src="d3/cubism.v1.min.js"></script>
	</head>
	<body>
		<div class="container">
			<div class="row">
				<div class="span10">
					<div class="page-header">
						<h1>Linac Status</h1>
					</div>
					<div class="row">
						<div class="span2">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>Machine Rate</h4>
							</div>
							<h1 class="bigfont"><span id="machineRate" class="PVmonitor" data-pv="SIOC:SYS0:ML00:AO467">120 Hz</span></h1>
						</div>
						<div class="span2">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>Bunch Charge</h4>
							</div>
							<h1 class="bigfont"><span id="bunchCharge" class="PVmonitor" data-pv="SIOC:SYS0:ML00:CALC997"></span></h1>
						</div>
						<div class="span6">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>L3 Energy</h4>
							</div>
							<h1 class="bigfont"><span id="L3Energy" class="PVmonitor" data-pv="SIOC:SYS0:ML00:AO500" data-precision="3">6.71 GeV</span> + <span id="L3Vernier" class="PVmonitor" data-pv="SIOC:SYS0:ML00:AO289">?</span></h1>
						</div>
					</div>
					<div class="row">
						<div class="span10">
							
							<table class="table" id="emittanceTable">
								<thead>
									<tr>
										<th></th>
										<th>X Emittance / Bmag</th>
										<th>Y Emittance / Bmag</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<th>OTR-2</th>
										<td><span id="OTR2XEmit" class="emittanceValue" data-pv="OTRS:IN20:571:EMITN_X" data-precision="2" data-units=""></span> / <span id="OTR2XMatch" class="matchingValue" data-pv="OTRS:IN20:571:BMAG_X" data-precision="2" data-units=""></span></td>
										<td><span id="OTR2YEmit" class="emittanceValue" data-pv="OTRS:IN20:571:EMITN_Y" data-precision="2" data-units=""></span> / <span id="OTR2YMatch" class="matchingValue" data-pv="OTRS:IN20:571:BMAG_Y" data-precision="2" data-units=""></span></td>
									</tr>
									<tr>
										<th>WS12</th>
										<td><span id="WS12XEmit" class="emittanceValue" data-pv="WIRE:LI21:293:EMITN_X" data-precision="2" data-units=""></span> / <span id="WS12XMatch" class="matchingValue" data-pv="WIRE:LI21:293:BMAG_X" data-precision="2" data-units=""></span></td>
										<td><span id="WS12YEmit" class="emittanceValue" data-pv="WIRE:LI21:293:EMITN_Y" data-precision="2" data-units=""></span> / <span id="WS12YMatch" class="matchingValue" data-pv="WIRE:LI21:293:BMAG_Y" data-precision="2" data-units=""></span></td>
									</tr>
									<tr>
										<th>LI28</th>
										<td><span id="LI28XEmit" class="emittanceValue" data-pv="WIRE:LI28:144:EMITN_X" data-precision="2" data-units=""></span> / <span id="LI28XMatch" class="matchingValue" data-pv="WIRE:LI28:144:BMAG_X" data-precision="2" data-units=""></span></td>
										<td><span id="LI28YEmit" class="emittanceValue" data-pv="WIRE:LI28:144:EMITN_Y" data-precision="2" data-units=""></span> / <span id="LI28YMatch" class="matchingValue" data-pv="WIRE:LI28:144:BMAG_Y" data-precision="2" data-units=""></span></td>
									</tr>
									<tr>
										<th>LTU</th>
										<td><span id="LTUXEmit" class="emittanceValue" data-pv="WIRE:LTU1:735:EMITN_X" data-precision="2" data-units=""></span> / <span id="LTUXMatch" class="matchingValue" data-pv="WIRE:LTU1:735:BMAG_X" data-precision="2" data-units=""></span></td>
										<td><span id="LTUYEmit" class="emittanceValue" data-pv="WIRE:LTU1:735:EMITN_Y" data-precision="2" data-units=""></span> / <span id="LTUYMatch" class="matchingValue" data-pv="WIRE:LTU1:735:BMAG_Y" data-precision="2" data-units=""></span></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<div class="row">
						<div class="span3">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>BC1 Peak Current</h4>
							</div>
							<h1><span id="BC1PeakCurrent" class="PVmonitor" data-pv="SIOC:SYS0:ML00:AO485">210 A</span></h1>
						</div>
						<div class="span3">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>L1S Phase</h4>
							</div>
							<h1><span id="L1SPhase" class="PVmonitor" data-pv="SIOC:SYS0:ML00:AO479" data-units="&deg" data-precision="1">-26.5&deg</span></h1>
						</div>
						<div class="span3">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>BC1 Energy</h4>
							</div>
							<h1><span id="BC1Energy" class="PVmonitor" data-pv="SIOC:SYS0:ML00:AO483"></span></h1>
						</div>
					</div>
					<div class="row">
						<div class="span3">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>BC2 Peak Current</h4>
							</div>
							<h1><span id="BC2PeakCurrent" class="PVmonitor" data-pv="SIOC:SYS0:ML00:AO195">3100 A</span></h1>
						</div>
						<div class="span3">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>L2 Phase</h4>
							</div>
							<h1><span id="L2Phase"  class="PVmonitor" data-pv="SIOC:SYS0:ML00:AO487" data-units="&deg" data-precision="1">-36.4&deg</span></h1>
						</div>
						<div class="span3">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>BC2 Energy</h4>
							</div>
							<h1><span id="BC2Energy" class="PVmonitor" data-pv="SIOC:SYS0:ML00:AO489" data-precision="1"></span></h1>
						</div>
					</div>
				</div>
				<div class="span9 offset1"><!-- FEL Status -->
					<div class="page-header">
						<h1>FEL Status</h1>
					</div>
					<div class="row">
						<div class="span3">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>FEL Pulse Energy</h4>
							</div>
							<h1 class="bigfont"><span id="GDETEnergy" class="PVmonitor" data-pv="SIOC:SYS0:ML00:CALC000" data-precision="1">4.3 mJ</span></h1>
						</div>
						<div class="span3">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>Photon Energy</h4>
							</div>
							<h1 class="bigfont"><span id="photonEnergy" class="PVmonitor" data-pv="SIOC:SYS0:ML00:AO627" data-precision="1"></span></h1>
						</div>
						<div class="span3">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>Scheduled User</h4>
							</div>
							<h1 class="bigfont"><span id="scheduledUser" class="PVmonitor" data-pv="SIOC:SYS0:ML01:SO0085" data-units="" data-updatetime="20000"></span></h1>
						</div>
					</div>
					<div class="row">
						<div class="span3">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>Pulse Length</h4>
							</div>
							<h1><span id="pulseLength" class="PVmonitor" data-pv="SIOC:SYS0:ML00:AO820">52 fs</span></h1>
						</div>
						<div class="span3">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>Energy Loss</h4>
							</div>
							<h1><span id="eLoss" class="PVmonitor" data-pv="SIOC:SYS0:ML00:AO556"></span></h1>
						</div>
						<div class="span3">
							<div class="page-header" style="padding-bottom:2px; margin-bottom:12px;">
								<h4>Amplification Mode</h4>
							</div>
							<h1><span id="amplificationMode" data-pv="SIOC:SYS0:ML00:CALC998" data-units="">?</span></h1>
						</div>
					</div>
					<div class="row">
						<div class="span10">
							
						</div>
					</div>
				</div>
			</div>
			<div class="row"><!-- graph row begin -->
				<div class="span20" id="history">
					<div class="page-header">
						<h1>24 Hour History</h1>
					</div>
					<script>
						//var plotWidth = 1770;
						var plotWidth = document.getElementById('history').offsetWidth;
						var context = cubism.context().step(24*60*60*1000 / plotWidth).size(plotWidth);
						var gdetdata = gdethistory();
						d3.select("#history").call(function(div) {
							div.append("div").attr("class","axis").call(context.axis().orient("bottom"));							
							div.selectAll(".horizon")
								.data([gdetdata])
								.enter().insert("div",".axis")
								.attr("class","horizon")
								.call(context.horizon()
										.extent([-4, 4])
										.height(150)
										.mode("mirror")
										.title("Gas Detector History")
										.colors(["#3182bd", "#3182bd"]));
						});
					
						function gdethistory() {
							return context.metric(function(start, stop, step, callback) {
								var gdets = [];
								var count = Math.floor((stop - start)/step);
								start = Math.floor(Number(start)/1000);
								stop = Math.floor(Number(stop)/1000);
								d3.json("http://lcls-prod02.slac.stanford.edu:8888/history?PV=GDET:FEE1:241:ENRC&style=4&start=" + start + "&end=" + stop + "&count=" + count, function(historyResults){
									gdets = historyResults.map(function(item){
										return item.value;
									});
									
									callback(null,gdets);
								});
							},null);
						}
					</script>
				</div>
			</div><!-- graph row end -->	
		</div><!-- container end -->
	</body>
	<script src="webPV-HTTP.js"></script>
</html>